<div layout="column" layout-fill>
  <div class="topbar-height" ng-include="'partials/topbar.html'">
  </div>
  <div flex>
    <div layout="row" layout-fill>
      <div class="sidebar-width" ng-include="'partials/sidebar.html'"></div>
      <div
        flex
        md-colors="{background: 'default-background-50'}"
        style="overflow-y: auto;"
      >
        
        <!-- Content -->
        <div layout-fill layout="column">
          <div class="page-header">
            <h1>
              CRAWLS
            </h1>
            <span class="md-subhead">
              Monitor and manage <span hyphe-glossary="crawl jobs"></span>. For a new <span hyphe-glossary="crawl"></span>, use the <a href="#/project/{{corpusId}}/importurls">IMPORT</a> page.
            </span>
          </div>
          <md-tabs md-border-bottom flex md-selected="selectedTab">
            <md-tab label="last crawl jobs">
              
              <!-- Loading -->
              <div ng-if="!listLoaded" layout-fill layout="column" layout-align="center center">
                <spinner class="center" text="''"/>
              </div>

              <!-- Loaded but empty -->
              <div ng-if="listLoaded && lastCrawlJobs.length == 0" layout-fill layout="column" layout-align="center center">
                <h3>No crawl job</h3>
              </div>

              <!-- Loaded -->
              <div ng-if="listLoaded && lastCrawlJobs.length > 0" layout-fill layout="column" style="padding: 8px; overflow: auto">
                <md-grid-list
                  md-cols-xs="1"
                  md-cols-sm="2"
                  md-cols-md="3"
                  md-cols-lg="5"
                  md-cols-gt-lg="6"
                  md-gutter="8px"
                  md-row-height="1:1"
                >
                  <md-grid-tile
                    ng-repeat="job in lastCrawlJobs|limitTo:30 track by $index"
                    ng-click="displayDetails(job, $event)"
                    class="pointable-grid-tile"
                  >
                    <div
                      layout="column"
                      layout-align="center center"
                      layout-fill
                      md-colors="{
                        'background': (job.globalStatus == 'CRASHED' || job.globalStatus == 'UNSUCCESSFUL')
                          ? ('default-warn-200')
                          : (
                            (job.globalStatus == 'CRAWLING' || job.globalStatus == 'INDEXING' || job.globalStatus == 'WAITING')
                            ? ('default-primary-500')
                            : (
                              (job.globalStatus == 'ACHIEVED')
                              ? ('default-background-200')
                              : (
                                (job.globalStatus == 'RETRIED')
                                ? ('default-primary-200')
                                : ('default-background-100')
                              )
                            )
                          )
                      }"
                    >
                      <div
                        water-loader
                        message="job.globalStatus"
                        message-only="!(job.globalStatus == 'CRAWLING' || job.globalStatus == 'INDEXING' || job.globalStatus == 'WAITING')"
                        cog="job.globalStatus == 'INDEXING' || job.globalStatus == 'WAITING'"
                      ></div>
                    </div>
                    <div
                      class="crawl-tile-overlay"
                      layout="column"
                      layout-fill
                      style="padding: 8px"
                      md-colors="{
                        'color': (job.globalStatus == 'CRAWLING' || job.globalStatus == 'INDEXING' || job.globalStatus == 'WAITING')
                          ? ('default-primary-50')
                          : ('default-background-700')
                      }"
                    >
                      <div flex>
                        <p class="title">
                          {{job.webentity_name || 'Web Entity Loading'}}
                        </p>
                        <p class="subtitle">
                          Scheduled <span tooltip="{{job.created_at|date}}">{{job.created_at|prettyDate}}</span>
                        </p>
                        <p ng-if="job.finished_at" class="subtitle">
                          Finished in {{job.finished_at - job.created_at|duration}}
                        </p>
                        <p class="subtitle" ng-if="job.crawl_arguments.phantom">
                          <span class="glyphicon glyphicon-bell"></span> Cautious crawl
                        </p>
                        <p class="subtitle">
                          Depth {{job.crawl_arguments.max_depth}}
                        </p>
                      </div>
                      <div layout="column" layout-align="center center" class="stats">
                        <div>
                          {{job.nb_crawled_pages}} page{{job.nb_crawled_pages | plural}} crawled
                        </div>
                        <div ng-show="job.nb_unindexed_pages">
                          ({{job.nb_unindexed_pages}} not indexed yet)
                        </div>
                      </div>
                    </div>

                  </md-grid-tile>
                </md-grid-list>
              </div>
            </md-tab>
            <md-tab label="all crawl jobs">

              <!-- Loading -->
              <div ng-if="!dynamicCrawlJobs" layout-fill layout="column" layout-align="center center">
                <spinner class="center" text="''"/>
              </div>

              <!-- List of all crawls -->
              <div
                ng-if="dynamicCrawlJobs"
                layout-fill
                layout="column"
              >
                <div flex>
                  <md-virtual-repeat-container layout-fill ng-if="dynamicCrawlJobs">
                    <md-list>
                      <md-subheader class="md-primary" style="height: 48px">
                        <div layout="row">
                          <div flex>
                            WEB ENTITY NAME
                          </div>
                          <div class="md-secondary crawljobs-col-dept">
                            <span><md-tooltip md-direction="top">Depth</md-tooltip>D</span>
                          </div>
                          <div class="md-secondary crawljobs-col-stat">Status</div>
                          <div class="md-secondary crawljobs-col-inde">
                            <span><md-tooltip md-direction="top">Pages indexed</md-tooltip>PI</span>
                          </div>
                          <div class="md-secondary crawljobs-col-craw">
                            <span><md-tooltip md-direction="top">Pages Crawled</md-tooltip>PC</span>
                          </div>
                          <div class="md-secondary crawljobs-col-disp">
                            <span><md-tooltip md-direction="top">Discovered Pages</md-tooltip><md-icon style="font-size: 1.5em;">description</md-icon></span>
                          </div>
                          <div class="md-secondary crawljobs-col-disl">
                            <span><md-tooltip md-direction="top">Discovered Links</md-tooltip><md-icon style="font-size: 1.5em;">link</md-icon></span>
                          </div>
                          <div class="md-secondary crawljobs-col-sche">SCHEDULED</div> 
                          <div class="md-secondary crawljobs-col-dura">DURATION</div>
                        </div>
                      </md-subheader>
                      <md-list-item
                        md-virtual-repeat="job in dynamicCrawlJobs"
                        md-item-size="48"
                        md-on-demand
                        class="crawljob-list-item"
                        ng-click="displayDetails(job)"
                        flex
                        md-colors="{
                          'background': (job.globalStatus == 'CRASHED' || job.globalStatus == 'UNSUCCESSFUL')
                            ? ('default-warn-200')
                            : (
                              (job.globalStatus == 'CRAWLING' || job.globalStatus == 'INDEXING' || job.globalStatus == 'WAITING')
                              ? ('default-primary-500')
                              : (
                                (job.globalStatus == 'ACHIEVED')
                                ? ('default-background-200')
                                : (
                                  (job.globalStatus == 'RETRIED')
                                  ? ('default-primary-200')
                                  : ('default-background-100')
                                )
                              )
                            )
                        }"
                      >
                        <span md-truncate flex>
                          {{job.webentity_name || 'Web Entity Loading'}}
                        </span>
                        <div class="md-secondary crawljobs-col-dept">{{job.crawl_arguments.max_depth}}</div>
                        <div class="md-secondary crawljobs-col-stat">{{job.globalStatus}}</div>
                        <div class="md-secondary crawljobs-col-inde">{{job.nb_crawled_pages - job.nb_unindexed_pages}}</div>
                        <div class="md-secondary crawljobs-col-craw">{{job.nb_crawled_pages}}</div>
                        <div class="md-secondary crawljobs-col-disp">{{job.nb_pages}}</div>
                        <div class="md-secondary crawljobs-col-disl">{{job.nb_links}}</div>
                        <div class="md-secondary crawljobs-col-sche"><span><md-tooltip md-direction="left">{{job.created_at|date}}</md-tooltip>{{job.created_at|prettyDate}}</span></div> 
                        <div class="md-secondary crawljobs-col-dura"><div ng-if="job.finished_at - job.created_at > 0">{{(job.finished_at - job.scheduled_at)|duration}}</div></div>
                      </md-list-item>
                    </md-list>
                  </md-virtual-repeat-container>
                </div>
              </div>
            </md-tab>
          </md-tabs>

        </div>

      </div>
    </div>
  </div>
</div>